{"version":3,"file":"index.esm.js","sources":["../src/active-type/ActiveType.js","../src/active-type/Query.js","../src/active-type/connection/Adapter.js","../src/active-type/events/update.js","../src/active-type/sources/RecordSource.js","../src/active-type/sources/CollectionSource.js","../src/active-type/connectSource.js","../src/active-type/associations/Base.js","../src/active-type/associations/HasMany.js","../src/active-type/associations/BelongsTo.js"],"sourcesContent":["export default class ActiveType {\n  static defineMethods() {\n    if (this._methodsDefined) return;\n\n    this._methodsDefined = true;\n\n    this.attributes && this.attributes.forEach(attribute => {\n      this.prototype[attribute] = function() { return this._data && this._data[attribute] };\n    })\n\n    this.associations && this.associations.forEach(association => {\n      this.prototype[association.name()] = function() { return this._associations && this._associations[association.name()] };\n    })\n  }\n\n  constructor(data) {\n    this._data = data;\n    this._associations = {};\n\n    this.buildAssociations(data);\n    this.constructor.defineMethods();\n  }\n\n  buildAssociations(data) {\n    if (!this.constructor.associations) return;\n\n    this.constructor.associations.forEach(association => {\n      const associationName = association.name();\n      if (!data[associationName]) return;\n      this._associations[associationName] = association.fromJson(data[associationName]);\n    });\n  }\n};\n","export default class Query {\n  constructor(adapter, showQuery, listQuery) {\n    this.adapter = adapter;\n    this.listQuery = listQuery;\n    this.showQuery = showQuery;\n  }\n\n  list(variables) {\n    const { adapter, listQuery } = this;\n    return adapter.execute(listQuery, variables);\n  }\n\n  show(variables) {\n    const { adapter, showQuery } = this;\n    return adapter.execute(showQuery, variables);\n  }\n};\n","export default class Adapter {\n  constructor(request, method, path) {\n    this.request = request;\n    this.method = method;\n    this.path = path;\n  }\n\n  execute(query, variables) {\n    const { path, request, method } = this;\n    return request[method](path, { query: query, variables: variables });\n  }\n};\n","export default function updateEvent() { return new Event('update') };\n","import update from '../events/update';\nimport { get } from 'lodash';\n\nexport default class RecordSource extends EventTarget {\n  constructor(type, query) {\n    super();\n\n    this.type = type;\n    this.query = query;\n\n    this._requested = false;\n    this._loading = false;\n\n    this.handleResponse = this.handleResponse.bind(this);\n  }\n\n  handleResponse(response) {\n    this._loading = false;\n    this._record = new this.type(this.recordData(response));\n\n    this.dispatchEvent(update());\n\n    return response;\n  }\n\n  recordData(response) {\n    return get(response, ['data', 'data', this.type.objectPath], null);\n  }\n\n  find(variables) {\n    this._requested = true;\n    this._loading = true;\n    this.dispatchEvent(update());\n\n    return this.query.show(variables).then(this.handleResponse);\n  }\n\n  requested() {\n    return this._requested;\n  }\n\n  loaded() {\n    return this._requested && !this._loading;\n  }\n\n  loading() {\n    return this._loading;\n  }\n\n  record() {\n    return this._record;\n  }\n};\n","export default class CollectionSource {\n\n}\n","import React, { useEffect, useState } from 'react';\nvar createReactClass = require('create-react-class');\nimport update from './events/update';\n\nexport default function(Component, sources) {\n  return createReactClass({\n    componentDidMount: function() {\n      this.state = {value: 0};\n\n      this.listener = function listener() {\n        this.setState({ value: this.state.value + 1 });\n      }.bind(this);\n\n      Object.values(sources).forEach(source => source.addEventListener('update', this.listener));\n    },\n    componentWillUnmount: function() {\n      Object.values(sources).forEach(source => source.removeEventListener('update', this.listener));\n    },\n    render: function() {\n      return <Component {...this.props} {...sources} />;\n    }\n  });\n}\n","export default class Base {\n  constructor(name, klass) {\n    this._name = name;\n    this._klass = klass;\n  }\n\n  klass() {\n    return this._klass;\n  }\n\n  name() {\n    return this._name;\n  }\n}\n","import Base from './Base';\n\nexport default class HasMany extends Base {\n  fromJson(data) {\n    const type = this.klass();\n    return data.map(datum => new type(datum));\n  }\n}\n","import Base from './Base';\n\nexport default class BelongsTo extends Base {\n  fromJson(datum) {\n    const type = this.klass();\n    return new type(datum);\n  }\n}\n"],"names":["ActiveType","_methodsDefined","attributes","forEach","attribute","prototype","_data","associations","association","name","_associations","data","buildAssociations","constructor","defineMethods","associationName","fromJson","Query","adapter","showQuery","listQuery","variables","execute","Adapter","request","method","path","query","updateEvent","Event","RecordSource","type","_requested","_loading","handleResponse","bind","response","_record","recordData","dispatchEvent","update","get","objectPath","show","then","EventTarget","CollectionSource","createReactClass","require","Component","sources","componentDidMount","state","value","listener","setState","Object","values","source","addEventListener","componentWillUnmount","removeEventListener","render","props","Base","klass","_name","_klass","HasMany","map","datum","BelongsTo"],"mappings":"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"}