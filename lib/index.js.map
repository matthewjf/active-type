{"version":3,"file":"index.js","sources":["../src/active-type/ActiveType.js","../src/active-type/ActiveQuery.js","../src/active-type/connection/Adapter.js","../src/active-type/events/update.js","../src/active-type/sources/BaseSource.js","../src/active-type/sources/RecordSource.js","../src/active-type/sources/CollectionSource.js","../src/active-type/connectSource.js","../src/active-type/associations/Base.js","../src/active-type/associations/HasMany.js","../src/active-type/associations/BelongsTo.js"],"sourcesContent":["export default class ActiveType {\n  static defineMethods() {\n    if (this._methodsDefined) return;\n\n    this._methodsDefined = true;\n\n    this.attributes && this.attributes.forEach(attribute => {\n      this.prototype[attribute] = function() { return this._data && this._data[attribute] };\n    })\n\n    this.associations && this.associations.forEach(association => {\n      this.prototype[association.name()] = function() { return this._associations && this._associations[association.name()] };\n    })\n  }\n\n  constructor(data) {\n    this._data = data;\n    this._associations = {};\n\n    if (data) this.buildAssociations(data);\n    this.constructor.defineMethods();\n  }\n\n  buildAssociations(data) {\n    if (!this.constructor.associations) return;\n\n    this.constructor.associations.forEach(association => {\n      const associationName = association.name();\n      if (!data[associationName]) return;\n      this._associations[associationName] = association.fromJson(data[associationName]);\n    });\n  }\n};\n","export default class ActiveQuery {\n  constructor(adapter, showQuery, listQuery) {\n    this.adapter = adapter;\n    this.listQuery = listQuery;\n    this.showQuery = showQuery;\n  }\n\n  list(variables) {\n    const { adapter, listQuery } = this;\n    return adapter.execute(listQuery, variables);\n  }\n\n  show(variables) {\n    const { adapter, showQuery } = this;\n    return adapter.execute(showQuery, variables);\n  }\n};\n","export default class Adapter {\n  constructor(request, method, path) {\n    this.request = request;\n    this.method = method;\n    this.path = path;\n  }\n\n  execute(query, variables) {\n    const { path, request, method } = this;\n    return request[method](path, { query: query, variables: variables });\n  }\n};\n","export default function updateEvent() { return new Event('update') };\n","import update from '../events/update';\nimport { get } from 'lodash';\n\nexport default class BaseSource extends EventTarget {\n  constructor(type, query, objectPath, options = {}) {\n    super();\n\n    this.type = type;\n    this.query = query;\n    this.objectPath = objectPath;\n\n    this._requested = false;\n    this._loading = false;\n\n    this.handleResponse = this.handleResponse.bind(this);\n  }\n\n  errorData(response) {\n    return get(response, ['data', 'errors'], null);\n  }\n\n  recordData(response) {\n    return get(response, ['data', 'data', this.objectPath], null);\n  }\n\n  dispatchUpdate() {\n    this.dispatchEvent(update());\n  }\n\n  requested() {\n    return this._requested;\n  }\n\n  loaded() {\n    return this._requested && !this._loading;\n  }\n\n  loading() {\n    return this._loading;\n  }\n\n  record() {\n    return this._record;\n  }\n\n  errors() {\n    return this._errors;\n  }\n};\n","import update from '../events/update';\nimport { get } from 'lodash';\nimport BaseSource from './BaseSource';\n\nexport default class RecordSource extends BaseSource {\n  handleResponse(response) {\n    this._loading = false;\n    this._record = new this.type(this.recordData(response));\n    this._errors = this.errorData(response);\n\n    this.dispatchUpdate();\n\n    return response;\n  }\n\n  find(variables) {\n    this._requested = true;\n    this._loading = true;\n    this.dispatchUpdate();\n\n    return this.query.show(variables).then(this.handleResponse);\n  }\n\n  record() {\n    return this._record;\n  }\n};\n","import { get } from 'lodash';\nimport BaseSource from './BaseSource';\n\nexport default class CollectionSource extends BaseSource {\n  constructor(type, query, objectPath, options = {}) {\n    super(type, query, objectPath);\n\n    this.args = {};\n    this.paginated = options.paginated;\n  }\n\n  handleResponse(response) {\n    this._loading = false;\n\n    this._records = this.recordData(response).map(datum => new this.type(datum));\n    this._errors = this.errorData(response);\n\n    if (this.paginated) this._paginationData = this.paginationData(response);\n\n    this.dispatchUpdate();\n\n    return response;\n  }\n\n  recordData(response) {\n    const results = get(response, ['data', 'data', this.objectPath], null);\n    if (this.paginated) return results.nodes;\n    return results;\n  }\n\n  paginationData(response) {\n    return get(response, ['data', 'data', this.objectPath, 'pageInfo'], null);\n  }\n\n  where(args) {\n    Object.assign(this.args, args);\n    return this;\n  }\n\n  all() {\n    this._requested = true;\n    this._loading = true;\n    this.dispatchUpdate();\n\n    return this.query.list(this.args).then(this.handleResponse);\n  }\n\n  records() {\n    return this._records;\n  }\n\n  hasNextPage() {\n    return this._paginationData && this._paginationData.hasNextPage || false;\n  }\n\n  nextPage() {\n    throw new Error('not implemented');\n  }\n};\n","import React, { useEffect, useState } from 'react';\nvar createReactClass = require('create-react-class');\nimport update from './events/update';\n\nexport default function(Component, sources) {\n  return createReactClass({\n    componentDidMount: function() {\n      this.state = {value: 0};\n\n      this.listener = function listener() {\n        this.setState({ value: this.state.value + 1 });\n      }.bind(this);\n\n      Object.values(sources).forEach(source => source.addEventListener('update', this.listener));\n    },\n    componentWillUnmount: function() {\n      Object.values(sources).forEach(source => source.removeEventListener('update', this.listener));\n    },\n    render: function() {\n      return <Component {...this.props} {...sources} />;\n    }\n  });\n}\n","export default class Base {\n  constructor(name, klass) {\n    this._name = name;\n    this._klass = klass;\n  }\n\n  klass() {\n    return this._klass;\n  }\n\n  name() {\n    return this._name;\n  }\n}\n","import Base from './Base';\n\nexport default class HasMany extends Base {\n  fromJson(data) {\n    const type = this.klass();\n    return data.map(datum => new type(datum));\n  }\n}\n","import Base from './Base';\n\nexport default class BelongsTo extends Base {\n  fromJson(datum) {\n    const type = this.klass();\n    return new type(datum);\n  }\n}\n"],"names":["ActiveType","_methodsDefined","attributes","forEach","attribute","prototype","_data","associations","association","name","_associations","data","buildAssociations","constructor","defineMethods","associationName","fromJson","ActiveQuery","adapter","showQuery","listQuery","variables","execute","Adapter","request","method","path","query","updateEvent","Event","BaseSource","type","objectPath","_requested","_loading","handleResponse","bind","response","get","dispatchEvent","update","_record","_errors","EventTarget","RecordSource","recordData","errorData","dispatchUpdate","show","then","CollectionSource","options","args","paginated","_records","map","datum","_paginationData","paginationData","results","nodes","Object","assign","list","hasNextPage","Error","createReactClass","require","Component","sources","componentDidMount","state","value","listener","setState","values","source","addEventListener","componentWillUnmount","removeEventListener","render","React","props","Base","klass","_name","_klass","HasMany","BelongsTo"],"mappings":"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"}